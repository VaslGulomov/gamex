<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');
        body {
            font-family: 'Montserrat';
        }
    </style>
    <title>GAMEX - Компьютерный клуб в Пушкино</title>
</head>
<body class="bg-neutral-800 text-xs font-montserrat font-semibold text-zinc-300 md:text-base">

    <header id="header">
        <div class="m-auto max-w-screen-xl p-4 flex justify-between items-center container">
            <a href="#" class="text-base flex justify-start items-center"><img src="/images/logo.webp" alt="" class="w-8 mr-2">GAMEX</a>
            <a href="tel:+79268439090" class="text-base">+7 (926) 843 90 90</a>
        </div>
    </header>

    <main class="mt-20">
        <!--ГЛАВНЫЙ ЭКРАН-->
        <article id="main">
            <div class="m-auto max-w-screen-xl p-4 container pb-0">
                <div class="md:grid md:grid-cols-2 md:gap-10">
                    <div>
                        <p class="text-red-500 animate-pulse text-center md:text-left">ПОЧУВСТВУЙ МОЩЬ</p>
                        <h1 class="text-4xl my-4 text-center font-bold md:text-6xl md:text-left">Компьютерный клуб в Пушкино</h1>
                        <p class="text-center opacity-50 mb-16 md:text-left">Что фтавз зво заовзщ оазщыв лызвщ лазы лазщ лвызщ л адвл ызавщ алщзы ващ лывщз лащ </p>
                        <a href="" class="p-3 bg-red-500 text-base flex justify-center items-center text-center mb-4">ПОЗВОНИТЬ</a>
                        <a href="#workload" class="p-3 border-2 border-red-500 text-base flex justify-center items-center">ЗАГРУЖЕННОСТЬ КЛУБА</a>
                        <p class="opacity-45 text-center mt-4 mb-10 md:text-left">* Посмотреть в прямом эфире, сколько и какие ПК свободны</p>
                    </div>
                    <img src="images/main.webp" alt="GAMEX">
                </div>
            </div>
        </article>
        <!--НАШЕ ЖЕЛЕЗО-->
        <article id="settings" class="bg-red-500">
            <div class="m-auto max-w-screen-xl p-4 container">
                <p class="text-neutral-800 animate-pulse mt-4">Где лучшее железо?</p>
                <h2 class="text-2xl my-2 md:text-4xl">У нас в клубе</h2>
                <div class="my-10 uppercase md:grid md:grid-cols-3 md:gap-10 md:py-10">
                    <div class="flex justify-start items-center gap-4">
                        <img src="/images/mon.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>BENQ ZOWIE 360Гц</p>
                            <p class="text-neutral-800"><span>STANDART: </span>AOC 240Гц</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-4 mt-6 md:mt-0">
                        <img src="/images/graphic-card.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>NVIDIA RTX 4070</p>
                            <p class="text-neutral-800 "><span>STANDART: </span>NVIDIA RTX 2060</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-4 mt-6 md:mt-0">
                        <img src="/images/headphone.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>LOGITECH G PRO X</p>
                            <p class="text-neutral-800"><span>STANDART: </span>HYPERX CLOUD II</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-4 mt-6 md:mt-0">
                        <img src="/images/keyboard.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>LOGITECH G PRO X</p>
                            <p class="text-neutral-800"><span>STANDART: </span>KEYROX TKL</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-4 mt-6 md:mt-0">
                        <img src="/images/mouse.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>LOGITECH G PRO X <span class="text-xs font-medium">Superlight</span></p>
                            <p class="text-neutral-800"><span>STANDART: </span>HYPERX Pulsefire Haste</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-4 mt-6 md:mt-0">
                        <img src="/images/chair.png" alt="" class="w-12">
                        <div>
                            <p class="font-bold text-base mb-1"><span>VIP: </span>DXRACER DRIFTING</p>
                            <p class="text-neutral-800"><span>STANDART: </span>Aerocool AC120 AIR</p>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <!--О КЛУБЕ-->
        <article class="mt-4">
            <div class="m-auto max-w-screen-xl p-4 container">
                <p class="text-red-500 animate-pulse mt-4">В ЖИВУЮ ЕЩЕ ЛУЧШЕ</p>
                <h2 class="text-2xl mt-2 md:text-4xl">Фотографии</h2>
                <div class="md:grid md:grid-cols-2 md:gap-10 md:py-10">
                    <div>
                        <hr class="mt-10 mb-2 border-red-500 w-2/3 flex justify-center items-center">
                        <p class="opacity-50 mb-4 text-xl">VIP</p>
                        <div class="grid grid-cols-2 gap-4">
                            <img src="/images/standart.webp" alt="">
                            <img src="/images/standart 2.webp" alt="">
                            <img src="/images/standart 3.webp" alt="">
                            <img src="/images/standart 5.webp" alt="">
                            <img src="/images/standart 6.webp" alt="">
                            <img src="/images/standart 7.webp" alt="">
                        </div>
                    </div>
                    <div>
                        <hr class="mt-10 mb-2 border-red-500 w-2/3 flex justify-center items-center">
                        <p class="opacity-50 mb-6 text-xl">STANDART</p>
                        <div class="grid grid-cols-2 gap-4">
                            <img src="/images/standart.webp" alt="">
                            <img src="/images/standart 2.webp" alt="">
                            <img src="/images/standart 3.webp" alt="">
                            <img src="/images/standart 5.webp" alt="">
                            <img src="/images/standart 6.webp" alt="">
                            <img src="/images/standart 7.webp" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <!--ПРАЙС-ЛИСТ-->
        <article class="bg-red-500 mt-10 pb-10 md:py-10">
            <div class="m-auto max-w-screen-xl p-4 container">
                <p class="text-neutral-800 animate-pulse mt-4">Всегда статичный</p>
                <h2 class="text-2xl my-2 md:text-4xl">Прайс-лист</h2>
                <div class="md:grid md:grid-cols-2 md:gap-10">
                    <div class="pt-4 md:pt-0">
                        <p class="opacity-50 mt-10 text-xl md:pb-6">STANDART</p>
                        <div class="my-4">
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base">
                                <p class="pb-1">1 час</p>
                                <p class="pb-1">100 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">3 часа</p>
                                <p class="pb-1">250 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">5 часов</p>
                                <p class="pb-1">450 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">Ночной пакет <span class="font-medium text-xs">22:00-08:00</span></p>
                                <p class="pb-1">500 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">Playstaion 5</p>
                                <p class="pb-1">250 ₽/ч</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-10">
                        <p class="opacity-50 text-xl md:pb-6">VIP</p>
                        <div class="my-4">
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base">
                                <p class="pb-1">1 час</p>
                                <p class="pb-1">150 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">3 часа</p>
                                <p class="pb-1">150 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">5 часов</p>
                                <p class="pb-1">150 ₽</p>
                            </div>
                            <div class="border-b border-neutral-800 flex justify-between items-center text-base mt-4">
                                <p class="pb-1">Ночной пакет <span class="font-medium text-xs">22:00-08:00</span></p>
                                <p class="pb-1">150 ₽</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <!--ЗАГРУЖЕННОСТЬ КЛУБА-->
        <article id="workload" class="pb-10 md:py-10 md:pb-20">
            <div class="m-auto max-w-screen-xl p-4 container">
                <div class="md:grid md:grid-cols-2 md:gap-10">
                    <div>
                        <p class="text-red-500 animate-pulse mt-4">ПРЯМОЙ ЭФИР</p>
                        <h2 class="text-2xl my-2">Загруженность</h2>
                        <div class="flex justify-start items-center gap-10 my-10">
                            <p class="opacity-50">STANDART</p>
                            <div class="flex justify-start items-center gap-2">
                                <div class="w-5 h-5 bg-red-500 border border-zinc-300 flex justify-start items-center"></div>
                                <p class="flex justify-start items-center">Свободно: <span id="free_pc" class="ml-1"></span></p>
                            </div>
                            <div class="flex justify-start items-center gap-2">
                                <div class="w-5 h-5 bg-neutral-800 border border-zinc-300"></div>
                                <p class="flex justify-start items-center">Занято: <span id="busy_pc" class="ml-1"></span></p>
                            </div>
                        </div>
                        <div id="pc_grid" class="grid grid-cols-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-4"></div>
                    </div>
                    <div>
                        <h2 class="text-2xl mt-10">Карта клуба</h2>
                        <p class="opacity-50 mb-10 mt-2">STANDART</p>
                        <img src="images/map.webp">
                    </div>
                </div>
            </div>
        </article>

    </main>

    <footer class="bg-red-500">
        <div class="m-auto max-w-screen-md p-4 container">
            <p class="text-neutral-800 mt-10 text-center">EAT PLAY REPEAT</p>
            <h2 class="text-2xl text-center mt-2">Ждем вас в GAMEX</h2>
            <div class="flex justify-evenly text-base text-neutral-800 items-center my-6">
                <a href="https://yandex.ru/maps/org/gamex/207335166240/?ll=37.835298%2C56.013404&z=14" target="_blank">Карта →</a>
                <a href="https://yandex.ru/maps/org/gamex/207335166240/reviews/?ll=37.835298%2C56.013404&z=14" target="_blank">Отзывы →</a>
            </div>
            <p class="text-center">© Все права защищены</p>
            <div class="text-xs opacity-50 my-2 text-center">
                <p>ОГРН: 320508100011212</p>
                <p>ИНН: 052347899044</p>
            </div>
        </div>
    </footer>

    <script>
        async function fetchPCs() {
            try {
                const response = await fetch('/api/pcs');
                const data = await response.json();
                generatePCElements(data.length);
                displayPCs(data);
            } catch (error) {
                console.log('Ошибка при загрузке данных:', error);
            }
        }

        function formatTimeLeft(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            let formatted = '';

            if (hours > 0) {
                formatted += `${hours} ч `;
            }
            if (minutes > 0) {
                formatted += `${minutes} мин`;
            }
            return formatted.trim() || 'Свободен';
        }

        function generatePCElements(pcCount) {
            const pcGrid = document.getElementById('pc_grid');
            pcGrid.innerHTML = '';  // Очищаем сетку

            for (let i = 1; i <= pcCount; i++) {
                const pcElement = document.createElement('div');
                pcElement.className = 'bg-neutral-800 p-1 text-center h-16 cursor-not-allowed';
                pcElement.id = `pc_name_${String(i).padStart(2, '0')}`;
                pcElement.innerText = `PC ${i}`;
                pcGrid.appendChild(pcElement);
            }
        }

        function displayPCs(data) {
            let freePCCount = 0;
            let busyPCCount = 0;
            
            data.forEach((pc, index) => {
                const pcElement = document.getElementById(`pc_name_${String(index + 1).padStart(2, '0')}`);
                if (pcElement) {
                    const pcName = pc.pc_name.replace(/^0+/, '');
                    const nameSpan = document.createElement('span');
                    nameSpan.innerText = pcName;
                    nameSpan.className = 'font-bold text-base';
                    const timeSpan = document.createElement('span');
                    timeSpan.className = 'text-xs font-thin';

                    const timeLeft = pc.status_connect_time_left;
                    const offerInUsing = pc.offer_in_using;

                    if (timeLeft === null || offerInUsing === "ADMIN") {
                        timeSpan.innerText = '\nСвободен';
                        pcElement.classList.remove('bg-neutral-800');
                        pcElement.classList.add('bg-red-500');
                        freePCCount++;  // Увеличиваем счетчик свободных ПК
                    } else {
                        const formattedTime = formatTimeLeft(timeLeft);
                        timeSpan.innerText = `\nЗанят\n ${formattedTime}`;
                        busyPCCount++;  // Увеличиваем счетчик занятых ПК
                    }

                    pcElement.innerHTML = '';
                    pcElement.appendChild(nameSpan);
                    pcElement.appendChild(timeSpan);
                }
            });

            // Обновляем количество свободных и занятых ПК в HTML
            const freePCElement = document.getElementById('free_pc');
            const busyPCElement = document.getElementById('busy_pc');
            
            freePCElement.innerText = `${freePCCount}`;
            busyPCElement.innerText = `${busyPCCount}`;
        }

        function startUpdating() {
            fetchPCs();
            setInterval(fetchPCs, 30000);
        }

        window.onload = startUpdating;
    </script>
</body>
</html>
